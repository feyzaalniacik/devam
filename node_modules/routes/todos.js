const { Router } = require("express");
const Todo = require("../model/Todo") //dosyayı burada kullanabilmek için

const router = Router()

// router.get('/cretae', (req, res) => {
//     res.render('create', {
//         title: 'Create List',
//         isCreate: true
//     })
// })

// router.get('/cretae', (req, res) => {
//     res.render('create', {
//         title: 'Create List',
//         isCreate: true
//     })
// })


router.get('/', async (req, res) => {

    const todos = await Todo.find({}).lean()

    res.render('index', {
        title: 'Todo List',
        isCreate: true,
        todos
    })
})

router.get('/cretae', (req, res) => {
        res.render('create', {
            title: 'Create List',
            isCreate: true
        })
    })

router.post('/create', async (req, res) => {
    const todo = new Todo({
        title: req.body.title,
        // creat sayfasındaki title tetiklenir ve body içerisinde gömülen değer gelir
        
        // NOT
        // title: req.params.title,
        // // creat sayfasındaki title tetiklenir ve url içinden taranıp gelir
    })
    await todo.save()

    res.redirect('/')
    // buradaki işi bitince / yapıp ana sayfaya döner
})
// butona basılınca buraya gelir

router.post('/complete', async (req, res) => {
    const todo = await Todo.findById(req.body.id)
    // index.hbs sayfasından id bulup getirir. express kullanarak getirir
    todo.completed = !todo.completed;
    await todo.save()
// '!todo.completed'den değer ne gelirse gelsin ters çevirip 'todo.completed'e kaydeder 
    res.redirect('/')
})


module.exports = router